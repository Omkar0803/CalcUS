{% extends 'frontend/base.html' %}

{% load static %}

{% block extrahead %}
	<title>CalcUS - Flowchart</title>
	<script src="{% static 'frontend/jquery.min.js' %}"></script>
	<script src="{% static 'frontend/jquery.toc.min.js' %}"></script>
	<link rel="stylesheet" href="{% static 'frontend/flowy.min.css' %}" type="text/css">
	<script src="{% static 'frontend/flowy.min.js' %}"></script>
    <script src="https://kit.fontawesome.com/8bfdbc9f0e.js" crossorigin="anonymous"></script>
	<style>
		.title {
			margin-top: 50px;
			margin-bottom: 20px;
		}

		h1 {
			text-align: center;
		}

		.content {
			
		}
        
        .blockelem:first-child {
            margin-top: 20px;
        }
        
        .blockelem {
            cursor: pointer;
            text-align: center;
            padding-top: 10px;
            border: 1px solid transparent;
            transition-property: box-shadow, height;
            transition-duration: .2s;
            transition-timing-function: cubic-bezier(.05, .03, .35, 1);
            border-radius: 5px;
            box-shadow: 0px 0px 30px rgba(22, 33, 74, 0);
            box-sizing: border-box;
        }

        .block {
            margin-top: 0px!important;
            white-space: nowrap;
            cursor: pointer;
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10 and IE 11 */
            user-select: none; /* Standard syntax */
        }

        .no-select {
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10 and IE 11 */
            user-select: none; /* Standard syntax */
        }

        .footer {
            display: none;
        }

        .flowy-button {
            margin: 5px;
        }

        #canvas {
            position: absolute;
            width: calc(100% - 30%);
            height: calc(100% - 71px);
            top: 71px;
            left: 15%;
            z-index: 0;
            overflow: auto;
            outline: 2px solid black;
        }
        .main_content {
            width: 90%!important;
            flex: 1;
            margin-left: 5%!important;
        }
	</style>
{% endblock %}

{% block content %}
<div class="content" >
    <div class="no-select" style="width:15%;float:left;">
        <div>
            <div style="display:inline-block" class="create-flowy blockelem">Calculation 1
				<i onclick="openParaModal()" style="cursor: pointer;margin-left:5px;" class="fa-solid fa-wrench"></i>
			</div>
        </div>
        <div>
            <div style="display:inline-block" class="create-flowy blockelem">Calculation 2
				<i onclick="openParaModal()" style="cursor: pointer;margin-left:5px;" class="fa-solid fa-wrench"></i>
			</div>
        </div>
		<div>
            <div style="display:inline-block" class="create-flowy blockelem">Calculation 3
				<i onclick="openParaModal()" style="cursor: pointer;margin-left:5px;" class="fa-solid fa-wrench"></i>
			</div>
        </div>
		<div>
            <div style="display:inline-block" class="create-flowy blockelem">Calculation 4
				<i onclick="openParaModal()" style="cursor: pointer;margin-left:5px;" class="fa-solid fa-wrench"></i>
			</div>
        </div>
		<div>
            <div style="display:inline-block" class="create-flowy blockelem">Calculation 5
				<i onclick="openParaModal()" style="cursor: pointer;margin-left:5px;" class="fa-solid fa-wrench"></i>
			</div>
        </div>
		<div>
            <div style="display:inline-block" class="create-flowy blockelem">Calculation 6
				<i onclick="openParaModal()" style="cursor: pointer;margin-left:5px;" class="fa-solid fa-wrench"></i>
			</div>
        </div>
    </div>
    <div style="width:10%;float:right">
        <button class="button flowy-button" onclick="deleteAllBlocks()">Delete All</button>
		<button class="button is-small flowy-button js-modal-trigger" data-target="modal-load-flowchart">Load Flowchart from DB</button>
		<button class="button is-small flowy-button js-modal-trigger" data-target="modal-open-naming-flowchart-modal">Save Flowchart to DB</button>
		<button class="button flowy-button" onclick="flowchartOutput()">Output</button>
		<label class="label">Import a flowchart</label>
		<div class="file is-small is-boxed has-name">
			<label class="file-label">
			  <input id="importJsonFile" class="file-input" type="file" name="resume">
			  <span class="file-cta">
				<span class="file-icon">
				  <i class="fas fa-upload"></i>
				</span>
				<span class="file-label">
				  File Upload
				</span>
			  </span>
			  <span id="importedFlowchartName" class="file-name">
				No file chosen
			  </span>
			</label>
		</div>
    </div>
    <div id="canvas">

    </div>
</div>
<div id="modal-open-naming-flowchart-modal" class="modal">
	<div class="modal-background"></div>
  	<div class="modal-card">
    	<header class="modal-card-head">
      		<p class="modal-card-title">Enter Flowchart Title</p>
    	</header>
    	<section class="modal-card-body">
      		<input id="flowchart-title" class="input is-primary" type="text" placeholder="Unnamed Flowchart">
    	</section>
    	<footer class="modal-card-foot">
     		<button onclick="saveFlowchartName()" class="button is-success">Save changes</button>
      		<button class="button">Cancel</button>
    	</footer>
  	</div>
	<button class="modal-close is-large" aria-label="close"></button>
</div>
<div id="modal-load-flowchart" class="modal">
	<div class="modal-background"></div>
  	<div class="modal-card">
    	<header class="modal-card-head">
      		<p class="modal-card-title">Load Flowcharts</p>
    	</header>
    	<section class="modal-card-body">
			<div class="select">
				<select id="flowchart-load-select">
				{% for flowchart in flowchartsData %}
					<option value="{{ flowchart.flowchart }}">{{ flowchart.name }}</option>
				{% endfor %}
				</select>
			</div>
    	</section>
    	<footer class="modal-card-foot">
     		<button onclick="loadFlowchart()" class="button is-success">Load Flowchart</button>
      		<button class="button">Cancel</button>
    	</footer>
  	</div>
	<button class="modal-close is-large" aria-label="close"></button>
</div>
<div class="modal modal-para" id="modal-js-example">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Set Parameters</p>
        <button class="delete" aria-label="close"></button>
      </header>
      <section class="modal-card-body">
        <!-- Content ... -->
        <div class="column" id="parameters_column">
			<div class="column" >
				<div class="box">
					<center>
						<div class="select">
							<select id="presets">
							</select>
						</div>
						<br />
						<a class="button is-info" onclick="load_selected_preset()">Load Preset</a>
						<a class="button is-info" onclick="save_preset()">Save Preset</a>
						<a class="button is-danger" onclick="delete_preset()">Delete Preset</a>
						<br />
						<a class="button is-info" onclick="set_project_default()">Set current parameters as project defaults</a>
						<div id="preset_msg">

						</div>
					</center>
				</div>
			</div>

			<form action="/submit_calculation/" method="post" id="calcform" enctype="multipart/form-data">

				{% if not ensemble and not structure %}

				<div class="columns">
					<div class="column">
						<div class="field">
							<label class="label">Draw a structure or choose a file</label>
							<div class="file has-name">
								<label class="file-label">
									<input class="file-input" type="file" name="file_structure" id="file_structure" multiple="multiple">
									<span class="file-cta">
										<span class="file-icon">
											<i class="fas fa-upload"></i>
										</span>
										<span class="file-label">
										File upload
										</span>
									</span>
									<span class="file-name" id="file_upload_name">
									No input file selected
									</span>
								</label>
							</div>
						</div>
					</div>
					<div class="column is-narrow has-text-centered" id="calc_parse_filenames_column" style="display: none;">
						<label class="label">Use filename(s)</label>
						<div class="control">
							<input type="checkbox" class="checkbox" id="calc_parse_filenames" name="calc_parse_filenames" onchange="toggle_visibility_molname(this);">
						</div>
					</div>

					<div class="column is-narrow has-text-centered" id="calc_combine_files_column" style="display: none;">
						<label class="label">Single ensemble</label>
						<div class="control">
							<input type="checkbox" class="checkbox" id="calc_combine_files" name="calc_combine_files">
						</div>
					</div>
				</div>

				<div class="field type_specific avail_Minimum_Energy_Path" style="display: none;">
					<div class="file">
						<label class="file-label">
							<input class="file-input" type="file" name="aux_file_structure" id="aux_file_structure">
								<span class="file-cta">
								<span class="file-icon">
									<i class="fas fa-upload"></i>
								</span>
								<span class="file-label">
								Upload auxiliary structure
								</span>
							</span>
						</label>
					</div>
				</div>

				{% endif %}
				{% csrf_token %}

				<div class="columns">
					<div class="column">
						{% if not calc and not ensemble and not structure %}
						<div class="field" id="calc_mol_name_field">
							<label class="label">Molecule Name</label>
							<div class="control">
								<input class="input" name="calc_mol_name" id="calc_mol_name" type="text">
							</div>
						</div>
						{% endif %}
						<div class="field" id="calc_name_field">
							<label class="label">Ensemble Name</label>
							<div class="control">
								<input class="input" name="calc_name" id="calc_name" type="text" placeholder="(Optional)">
							</div>
						</div>
					</div>

					<div class="column">
						<div class="field">
							<label class="label">Charge</label>
							<div class="control" >
								<input class="input" name="calc_charge" id="calc_charge" type="text" value="0">
							</div>
						</div>
					</div>
					<div class="column">
						<div class="field">
							<label class="label">Multiplicity</label>
							<div class="control" >
								<input class="input" name="calc_multiplicity" id="calc_multiplicity" type="text" value="1">
							</div>
						</div>
					</div>
				</div>
				<div class="columns">
					<div class="column is-narrow">
						<div class="field">
							<label class="label">Solvent</label>
							<div class="control">
								<input class="input" name="calc_solvent" id="calc_solvent" type="text" oninput="refresh_availabilities();" list="solvent_options">
							</div>
							<p class="check_msg is-danger" id="solvent_check_msg"></p>
						</div>
					</div>
					<div class="column is-narrow">
						<div class="field" id="calc_solvation_model_field">
							<label class="label">Solvation Model</label>
								<div class="control">
									<div class="select">
									<select name="calc_solvation_model" id="calc_solvation_model" onchange="refresh_availabilities();">
										<option class="software_specific avail_xtb type_specific avail_Constrained_Optimisation avail_Constrained_Conformational_Search avail_Geometrical_Optimisation avail_Frequency_Calculation avail_UV-Vis_Calculation avail_Single-Point_Energy avail_Conformational_Search">GBSA</option>
										<option class="software_specific avail_xtb">ALPB</option>
										<option class="software_specific avail_Gaussian avail_ORCA">SMD</option>
										<option class="software_specific avail_Gaussian">PCM</option>
										<option class="software_specific avail_Gaussian avail_ORCA">CPCM</option>
									</select>
									</div>
								</div>
						</div>
					</div>
					<div class="column is-narrow">
						<div class="field software_specific avail_Gaussian avail_ORCA" id="calc_solvation_radii_field">
							<label class="label">Solvation Radii</label>
							<div class="control">
								<div class="select">
									<select name="calc_solvation_radii" id="calc_solvation_radii">
										<option class="solvation_model_specific avail_SMD">SMD18</option>
									    	<option class="solvation_model_specific avail_SMD">Default</option>
									    	<option class="solvation_model_specific avail_PCM avail_CPCM">UFF</option>
									    	<option class="solvation_model_specific avail_PCM avail_CPCM">UA0</option>
									    	<option class="solvation_model_specific avail_PCM avail_CPCM">UAHF</option>
									    	<option class="solvation_model_specific avail_PCM avail_CPCM">UAKS</option>
									    	<option class="solvation_model_specific avail_PCM avail_CPCM">Pauling</option>
									    	<option class="solvation_model_specific avail_PCM avail_CPCM">Bondi</option>
									</select>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="columns">
					<div class="column is-narrow">
						<div class="field">
							<label class="label">Project</label>
							<div class="control">
								<div class="select" >
								  <select name="calc_project" onchange="project_selection_changed(this)" id="calc_project">
									  {% for proj in profile.project_set.all|dictsort:"name" %}
									  <option name="{{ proj }}">{{ proj }}</option>
									  {% endfor %}
									  <option name="new_project">New Project</option>
								  </select>
								</div>
							</div>
						</div>

					</div>
					<div class="column">
						<div class="field" style="display: none;" id="new_project_name_field">
							<label class="label">Name of new project</label>
							<div class="control">
								<input class="input" name="new_project_name" type="text" placeholder="My Project">
							</div>
						</div>
					</div>

				</div>

				<div class="field">
					<label class="label">Software</label>
					<div class="control" >
						<div class="select">
							<select name="calc_software" id="calc_software" onchange="refresh_availabilities();">
								<option {% if 'xtb' not in packages %}class="resource_specific avail_remote"{% endif %}>xtb</option>
								<option {% if 'ORCA' not in packages %}class="resource_specific avail_remote"{% endif %}>ORCA</option>
								<option {% if 'Gaussian' not in packages %}class="resource_specific avail_remote"{% endif %}>Gaussian</option>
							</select>
						</div>
					</div>
				</div>

				<div class="field">
					<label class="label">Calculation Type</label>
					<div class="control" >
						<div class="select">
							<select name="calc_type" id="calc_type" onchange="calc_selection_changed();">
							{% for proc in procs %}
							<option class="software_specific {% if proc.avail_xtb %}avail_xtb{% endif %} {% if proc.avail_ORCA %}avail_ORCA{% endif %} {% if proc.avail_Gaussian %}avail_Gaussian{% endif %}">{{ proc.name }}</option>
							{% endfor %}
							</select>
						</div>
					</div>
				</div>
				<div class="type_specific avail_Minimum_Energy_Path" id="aux_structure_div">
					<div class="field">
						<label class="label">Existing auxiliary structure</label>
						<div class="control" id="aux_structure">
							<div class="columns">
								<div class="column">
									<label class="label">Molecule</label>
									<div class="select" id="aux_mol_select">
										<select name="aux_mol" id="aux_mol" onchange="refresh_aux_ensemble();">
										</select>
									</div>
								</div>
								<div class="column">
									<label class="label">Ensemble</label>
									<div class="select">
										<select name="aux_ensemble" id="aux_ensemble" onchange="refresh_aux_structure();">
										</select>
									</div>
								</div>
								<div class="column">
									<label class="label">Structure</label>
									<div class="select">
										<select name="aux_struct" id="aux_struct">
										</select>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div style="display: none;" class="type_specific avail_Constrained_Optimisation avail_Constrained_Conformational_Search" id="constraint_div">
					<div class="field">
						<label class="label">Constraints and scan coordinates</label>
						<div id="constraint_list">
						</div>
					</div>
				</div>

				<div class="software_specific avail_ORCA avail_Gaussian">
					<div class="field">
						<label class="label">Theory Level</label>
						<div class="control" >
							<div class="select">
								<select name="calc_theory_level" id="calc_theory_level" onchange="refresh_availabilities();">
									<option class="type_exclusion not_avail_UV-Vis_Calculation">Semi-empirical</option>
									<option>HF</option>
									<option>DFT</option>
									<option class="software_specific avail_ORCA">RI-MP2</option>
								</select>
							</div>
						</div>
					</div>
					<div class="columns">
						<div class="method_specific avail_DFT">
							<div class="column is-narrow software_specific avail_ORCA ">
								<div class="field">
									<label class="label">Special</label>
									<label class="checkbox">
										<input type="checkbox" name="pbeh3c" id="pbeh3c" onchange="refresh_availabilities();">
										PBEh-3c
									</label>		
								</div>
							</div>
						</div>
						<div class="method_specific avail_HF">
							<div class="column is-narrow software_specific avail_ORCA ">
								<div class="field">
									<label class="label">Special</label>
									<label class="checkbox">
										<input type="checkbox" id="hf3c" name="hf3c" onchange="refresh_availabilities();">
										HF-3c
									</label>		
								</div>
							</div>
						</div>
						<div class="column method_specific avail_Semi-empirical">
							<div class="field">
								<label class="label">Method</label>
								<div class="control">
									<div class="select">
										<select name="calc_se_method" id="calc_method">
											<option>AM1</option>
											<option>PM3</option>
											<option class="software_specific avail_Gaussian">PM6</option>
											<option class="software_specific avail_Gaussian">PM7</option>
										</select>
									</div>
								</div>
							</div>
						</div>


						<div class="column method_specific avail_DFT">
							<div class="field" id="calc_functional_field">
								<label class="label">Functional</label>
								<div class="control">
									<input class="input" name="calc_functional" id="calc_functional" type="text" list="functional_options">
								</div>
								<p class="check_msg is-danger" id="functional_check_msg"></p>
							</div>
						</div>
						<div class="column method_specific avail_DFT avail_RI-MP2 avail_HF">
							<div class="field" id="calc_basis_set_field">
								<label class="label">Basis set</label>
								<div class="control">
									<input class="input" name="calc_basis_set" id="calc_basis_set" type="text" list="basis_sets_options">
								</div>
								<p class="check_msg is-danger" id="basis_set_check_msg"></p>
							</div>
						</div>

					</div>
				</div>
				<br />
				<div>
						<div>
							<div class="field" id="custom_specifications_field">
								<label class="label">Specifications</label>
								<div class="control">
									<input class="input" name="calc_specifications" id="calc_specifications" type="text" placeholder="" >
								</div>
							</div>
						</div>
						<div class="method_specific avail_DFT">
							<div class="field software_specific avail_Gaussian">
								<label class="label">Density Fitting</label>
								<div class="control">
									<input class="input" name="calc_df" id="calc_df" type="text" placeholder="" >
								</div>
							</div>
						</div>
						<div class="method_specific avail_DFT avail_RI-MP2 avail_HF">
							<div class="field" id="custom_bs_field">
								<label class="label">Custom basis sets</label>
								<div class="control">
									<input class="input" name="calc_custom_bs" id="calc_custom_bs" type="text" placeholder="" >
								<button class="button is-info" id="pick_bs_button" type="button">Pick custom basis sets</button>
								</div>
							</div>

							<div class="modal pick_bs_div" id="pick_bs_div">
								<div class="modal-card">
									<header class="modal-card-head">
										<p class="modal-card-title">Specific basis sets</p>
										<button type="button" class="close_btn close_bs modal-close is-large" aria-label="close"></button>
									</header>
									<section class="modal-card-body" id="custom_bs_body">
									</section>
								</div>
							</div>
						</div>
				</div>
				<br />
				<div class="field">
					<label class="label">Resource</label>
					<div class="control" >
						<div class="select">
						<select name="calc_resource" id="calc_resource" onchange="refresh_availabilities();">
							{% if allow_local_calc %}
								{% if profile.group or profile.is_PI or request.user.is_superuser %}
									<option>Local</option>
								{% endif %}
							{% endif %}
							{% for access in profile.accesses %}
								{% if access.connected %}
									<option>{{ access.cluster_address }}</option>
								{% endif %}
							{% endfor %}
						  </select>
						</div>
					</div>
				</div>

				{% if ensemble and not structures %}
					<div class="columns">
						<div class="column">
							<div class="field">
								<label class="label">Filter</label>
								<div class="control" >
									<div class="select">
									<select name="calc_filter" onchange="filter_changed();" id="calc_filter">
										<option>None</option>
										<option>By Relative Energy</option>
										<option>By Boltzmann Weight</option>
									  </select>
									</div>
								</div>
							</div>
						</div>
						<div class="column">
							<div class="field" style="display: none;" id="calc_filter_value">
								<label class="label" id="filter_label">Higher than</label>
								<div class="control">
									<input class="input" name="filter_value" type="text" id="filter_value_input">
								</div>
							</div>
						</div>
						<div class="column">
							<div class="field" id="calc_filter_params">
								<label class="label">Parameters</label>
								<div class="control" >
									<div class="select">
									<select name="filter_parameters">
										{% for p in ensemble.unique_parameters %}
											<option value="{{ p.id }}">{{ p }}</option>
										{% endfor %}
									  </select>
									</div>
								</div>
							</div>
						</div>

					</div>

				{% endif %}

				<div class="field">
					<span id="form_error_msg"></span>
					<div class="control">
						<a class="button is-primary" id="submit_button" onclick="verify_form()">Submit</a>
					</div>
				</div>
			</form>
		</div>
      </section>
      <footer class="modal-card-foot">
        <button style="background-color: #00a759" class="button is-success">Save changes</button>
        <button class="button">Cancel</button>
      </footer>
    </div>
</div>
<script>
	function decodeJSON(inputJSON) {
		const replaceWithcomma = '"'
		var result = inputJSON.replace(/&quot;/g, replaceWithcomma)
		const replacewithLessThan = '<'
		result = result.replace(/&amp;lt;/g, replacewithLessThan)
		const replacewithGreaterThan = '>'
		result = result.replace(/&amp;gt;/g, replacewithGreaterThan)
		result = result.replace(/&lt;/g, replacewithLessThan)
		result = result.replace(/&gt;/g, replacewithGreaterThan)
		result = result.replace(/<i>/g, '<i onclick=\\"openParaModal()\\" style=\\"cursor: pointer;margin-left:5px;\\" class=\\"fa-solid fa-wrench\\">')
		return result;
	}

	function saveFlowchartName() {
		const flowchartTitleUser = document.getElementById("flowchart-title").value
		Submit(flowchartTitleUser)
	}

	function loadFlowchart() {
		flowy.deleteBlocks()
		flowy.import(JSON.parse(decodeJSON(document.getElementById("flowchart-load-select").value)))
	}

	var spacing_x = 40;
    var spacing_y = 100;
    var flowyOut;
    document.addEventListener("DOMContentLoaded", function(){
        hardCodedInput();
    })
    // Initialize Flowy
    flowy(document.getElementById("canvas"), onGrab, onRelease, onSnap, onRearrange, spacing_x, spacing_y);
    function onGrab(block){
        // When the user grabs a block
        console.log("Grabbed")
    }

    function onRelease(){
        // When the user releases a block
        console.log("Released")
    }

    function onSnap(block, first, parent){
        // When a block snaps with another one
        console.log("Snapped")
		return true;
    }

    function onRearrange(block, parent){
        // When a block is rearranged
        console.log("Rearranged")
        return false;
    }

    function deleteAllBlocks() {
        flowy.deleteBlocks();
        hardCodedInput();
    }

    function flowchartOutput() {
        console.log("Output")
        console.log(flowy.output());
        flowyOut = flowy.output();
        var htmlContent = JSON.stringify(flowy.output());
        var bl = new Blob([htmlContent], {type: "text/json"});
        var a = document.createElement("a");
        a.href = URL.createObjectURL(bl);
        a.download = "flowchart.json"
        a.hidden = true;
        document.body.appendChild(a);
        a.innerHTML = "File Link";
        a.click();
    }

    function flowchartInput() {
        flowy.import(flowyOut);
    }

    function Submit(flowchartTitle) {
        console.log("Submitted")
		if(flowchartTitle!="")
			name = flowchartTitle
		else
			name = "Unnamed Flowchart"
		flowchart_data = JSON.stringify(flowy.output());
		$.ajax({
			method: "POST",	 	 
			url: "/create_flowchart/",
			headers: {
				"X-CSRFToken": '{{ csrf_token }}',
			},
			data: {'flowchart_name': name, 'flowchart_data': flowchart_data},
			success: function() {
				console.log("Success")	
			}
		});
    }

	function openParaModal() {
        console.log("Clicked")
		$(".modal-para").addClass("is-active");
    }
    
    function hardCodedInput() { 
        var hardCodedObject = {
            "html": "\n\n    <div class=\"indicator invisible\"></div><div class=\"blockelem block\" style=\"left: 431.297px; top: 9px;\">Input<input type=\"hidden\" name=\"blockid\" class=\"blockid\" value=\"0\"></div>",
            "blockarr": [
                {
                    "parent": -1,
                    "childwidth": 0,
                    "id": 0,
                    "x": 451.296875,
                    "y": 27,
                    "width": 40,
                    "height": 36
                }
            ],
            "blocks": [
                {
                    "id": 0,
                    "parent": -1,
                    "data": [
                        {
                            "name": "blockid",
                            "value": "0"
                        }
                    ],
                    "attr": [
                        {
                            "class": "blockelem block"
                        },
                        {
                            "style": "left: 431.297px; top: 9px;"
                        }
                    ]
                }
            ]
        }
            
        //console.log(hardCodedObject);
        flowy.import(hardCodedObject);
    }

	document.querySelector('#importJsonFile').addEventListener('change', function() {
		if (this.files && this.files[0]) {
			var reader = new FileReader();
		  	reader.onload = function(e) {
				annotationsObject = JSON.parse(reader.result);
				flowy.deleteBlocks();
				flowy.import(annotationsObject)
				document.getElementById("importedFlowchartName").textContent = document.getElementById("importJsonFile").files[0].name;
				importedFlowchart = annotationsObject;
		  	};
		  	reader.readAsText(this.files[0])
		}
	});

    document.addEventListener('DOMContentLoaded', () => {
        // Functions to open and close a modal
        function openModal($el) {
          $el.classList.add('is-active');
        }
      
        function closeModal($el) {
          $el.classList.remove('is-active');
        }
      
        function closeAllModals() {
          (document.querySelectorAll('.modal') || []).forEach(($modal) => {
            closeModal($modal);
          });
        }
      
        // Add a click event on buttons to open a specific modal
        (document.querySelectorAll('.js-modal-trigger') || []).forEach(($trigger) => {
          const modal = $trigger.dataset.target;
          const $target = document.getElementById(modal);
      
          $trigger.addEventListener('click', () => {
            openModal($target);
          });
        });
      
        // Add a click event on various child elements to close the parent modal
        (document.querySelectorAll('.modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button') || []).forEach(($close) => {
          const $target = $close.closest('.modal');
      
          $close.addEventListener('click', () => {
            closeModal($target);
          });
        });
      
        // Add a keyboard event to close all modals
        document.addEventListener('keydown', (event) => {
          const e = event || window.event;
      
          if (e.keyCode === 27) { // Escape key
            closeAllModals();
          }
        });
    });
</script>
{% endblock %}

